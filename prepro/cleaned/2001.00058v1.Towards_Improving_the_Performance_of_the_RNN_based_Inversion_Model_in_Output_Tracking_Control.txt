introduction  piezo actuators  peas  have been widely used for nanopositioning related applications such as investigating the mechanic properties of materials based on atomic force microscope  afm       aeroelastic control of aircraft wings       and vibration control    . even though there have been many  models developed to capture the dynamics of peas  the  challenge of controlling piezo actuators still lies in modeling  the nonlinearities hysteresis and creep effects over large  frequency bandwidth and amplitude span    .  recently  neural networks have been proposed to model  the dynamics of peas         . however  the feedforward  neural network is not able to the utilize the sequence  information of the input         . in contrast  the input to  the recurrent neural network  rnn  is a time series  thus  it is more suitable for modeling the dynamical system and  can achieve any level of modeling accuracy given enough  number of parameters    . in our previous work  rnn  has been proposed for modeling pea systems    . since  the obtained rnn is equivalent to a nonlinear state space  model  a nonlinear predictive controller has been proposed  to realize output tracking    . however  the computation load    s. xie and   j. ren are with the department of mechanical engineering  iowa state university  ames  ia        usa  swxie iastate.edu juanren iastate.edu    corresponding author.    is very heavy which limits the prediction horizon and further  improvement of the control precision.  alternatively  rnn can be used to model the inversion  dynamics of the pea system    . compared to some existing  models  such as the ferromagnetic material hysteresis        prandtl ishlinskii hysteresis inversion model       rnnbased inversion model  rnninv  can achieve large modeling  bandwidth and high accuracy. moreover  since the inversion  model is used without an extra controller  it avoids the heavy  computation burden for real time applications. nevertheless   it shows that rnninv cannot fully account for the lowfrequency dynamics and time varying dynamics of peas due  to the length limit of the rnn training set  thus a linear  model embedded with an error term  lme  has been proposed to make a predictive controller for trajectory tracking  at low frequencies    . although lme is expected to account  for the low frequency dynamics only  it will interfere with  the control contribution of the rnninv at high frequencies  resulting in an increase of the tracking errors    . also  due to  the limited length of the training set  the sampling frequency  of rnn can not be set very high. therefore  this article is  motivated to overcome these two issues of rnninv for pea  output tracking.  the main contribution of this work is the development of  a novel modeling approach such that the dynamics of the  system is separated based on the frequency ranges. specifically  for a linear system model m  its dynamics is sperated  into two linear models a and b in such a way that the highfrequency dynamics of m is characterized by a while the  low frequency dynamics by b. in terms of this work  let m  denote the dynamics of rnninv pea  it is expected that  lme accounts for the low frequency dynamics  a  of the  rnninv pea system while the high frequency dynamics   b  is close to    i.e.  m  j       for large    given that  rnninv can efficiently account for the pea high frequency  dynamics. another contribution is that for the rnn trained  with the sampling frequency of fs   an interpolation method  is proposed to make it able to be operated at the sampling  frequency of   fs . the reason for doing this is that for some  applications such as high speed afm imaging  the sampling  frequency can affect the spatial resolution of the obtained  images thus high sampling frequency is preferred           .  to realize precision trajectory tracking  a predictive controller based on the model m is used. note that m has  parameters which differentiate between  high frequency   and  low frequency . it turns out that these parameters can  affect the stability of the predictive controller. in other  words  apart from the parameters of the predictive controller      the parameters of m should also be chosen carefully to  ensure the closed loop stability. it should be noted that it  is quite difficult to analyze the closed loop stability of mpc.  although sometimes prediction horizon nh cannot be tuned  to stabilize the system       generally speaking  large nh can  ensure the closed loop stability especially for linear systems.  many theoretical results account for a general system and  thus quite conservative       or focus on setpoint stabilization      thus not applicable for general reference tracking  problem. in this work  we analyze the closed loop stability of  the unconstrained predictive control problem. results about  the closed loop stability as well as how they are used to  determine the relevant parameters are also presented.  ii. p reliminaries  the rnn based inversion model  rnninv  can be represented by the follow state space model   xk     tanh w  xk   b    b  u r  k       y r  k   w  xk   b            rn        where xk    u r  k   and y r  k are the system states   input and output at the sampling instant k  respectively. the  diagram of the controller for output tracking is shown in  fig.  . as can be seen in fig.    rnninv is cascaded with  the pea system forming the system h    . since rnninv  can account for the high frequency dynamics accurately with  the low frequency dynamics partly modeled  h is modeled  by the following linear model embedded with an error term   lme  to account for the time varying and low frequency  dynamics    k     ae  k   be u k   ge e k  y k   ce  k                where u k is the input to the lme  e k   yk   y k is the model  output error with yk as the actual pea output. the problem  is that the high frequency dynamics of lme will interfere  with that of h resulting in modeling control errors. with the  new modeling method in the next section  the high frequency  dynamics of lme will not affect that of h.  iii. m odel the s ystem dynamics  a. incorporating the lme  suppose we have a system g such that its dynamics in the  frequency range   fh   fs     coincides with that of system g     uk    lpf     rnninv    yk    pea    h    state estimator     k  lme  lpf   plant model  predictive controller    rk    fig.    schematic block diagram of using rnninv for pea  output tracking.    and the dynamics in     fl   can be characterized by that of  system g    the goal is to represent g  j   with g    j   and  g    j  . note that fl   fh . instead of solving the problem  directly  we introduce extra dynamics ge and show that ge g  can be represented by g    g  and ge with the following  proposition. here  we use ge g to denote the dynamics of  the system combining ge and g. g  g    and g  can be  expressed in state space forms with eq.      eq.      and eq.       respectively.  xg k     f  xg k   ug k    yg k   h xg k    xg  k     f   xg  k   ug  k    yg  k   h   xg  k    xg  k     f   xg  k   ug  k    yg  k   h   xg  k                           proposition  . assume g satisfies  f  a   b  c   d    f  a  c    f  b  d            ge is constructed with a parallel connection of a high pass  filter  hpf   eq.      and a low pass filter  lpf   eq.       as shown in fig.   a .   k     a  k   b u k  z k   c  k   k     a k   buk  zk   c k                  g  and g  are described as above. then ge g can be  represented by             a  k     b u k   k     xg  k       f   xg  k   c  k                   k          k     buk   .       xg  k    f   xg  k   c k    zg k  h   xg  k     h   xg  k    proof. ge is shown in fig.   a . with the assumption  eq.      fig.   a  is equivalent to fig.   b . the hpf can be  tuned to only allow signals in the frequency range   fh   fs      to pass and similar for lpf  only signals in the frequency  range     fl   can pass. then fig.   b  is equivalent to fig.    c  which can be expressed using eq.    . this completes  the proof.    remark  . the cutoff frequencies fcl  lpf  and fch  hpf   should be chosen such as that the signals at all the frequencies can pass through ge . if the system is linear  eq.      would be satisfied automatically. if eq.     does not hold   there will be modeling errors for the proposed modeling  approach.  remark  . in the case that g represents the dynamics of  pea rnninv  it is clear that g is linear if the nonlinear  dynamics of the pea is compensated by the rnninv. then  g  is expressed in eq.      and g    j       i.e.  yg  k   ug  k .     b. increase the sampling frequency of the rnninv control    ge     a     if the sampling frequency of the rnninv training set is fs    then the time interval between uk and uk   is    fs . consider  that the sampling frequency in real time application becomes    fs   the following state space equation can be used based on  eq.    .    hpf     lpf    g    xk     tanh w  xk   b    b  u r  k       b     hpf    y r  k   w  xk   b     g    basically  eq.      is equivalent to two eq.    s running  separately with the initial states of x  and x    respectively.  x  and x  can be set to zeros at the beginning. two sets of  states  i.e.   x    x    x            and  x    x    x             are obtained  separately without affecting each other. note that for each  time series  the time interval between the corresponding  inputs uk and uk   becomes    fs .  next  we argue that the modeling accuracy is not affected with the sampling frequency doubled. suppose the  expected output series should be y k   if both output series   y    y    y            and  y    y    y            have the accuracy of             i.e.  max  y k     y  k         and max  y k   y  k                 c     lpf    g    hpf    g     lpf    g                  k    k    it follows that max  yk   y k        which implies that the  k  accuracy of the model eq.      remains unchanged after the  sampling frequency is increased.    fig.    combine two models.    bpf  iv. s tability of the p redictive c ontroller    uk       lpf    rnninv  ge    h    yk    pea    state estimator     k  ge  rnninv pea  plant model  predictive controller    rk    fig.    schematic block diagram of the rnninv control  with the proposed modeling method.  also  eq.     is linear and can be further simplified. to apply  the new modeling method to the controller  the control loop  shown in fig.   can be modified to that represented in fig.  .  note that lpf  in fig.   has been combined with ge because  the cutoff frequency of lpf  is usually much larger than that  of fl and fh   thus we only need to replace hpf with a bandpass filter  bpf  with the passing frequency range of   fh   fc       fc  is the cutoff frequency of lpf  in fig.    as shown in  fig.  .  remark  . note that the dynamics of the added ge have  been included in the model for controller design  therefore   the phase lag and other dynamics of ge will not affect the  tracking performance since they are accounted for by the  predictive controller.    in this work  the case of unconstrained mpc is considered  in the situation where the sampling frequency is very high   like trajectory tracking of pea systems  so adding input  constraints will significantly increase the computation burden. although faster platform based on fpga can accelerate  the computation process  it is still challenging to realize  online mpc with high sampling frequency     . moreover   the prediction horizon should be large to ensure the closedloop stability. this brings extra challenges in incorporating  constraints in mpc even with high speed platforms.  for the unconstrained mpc based on the linear system   by choosing sufficiently large prediction horizon  the closedloop stability can always be achieved. the question is how  to choose the smallest prediction horizon while maintaining  the closed loop stability.  we consider the mpc based on the following linear  system   xk     axk   buk    k        yk   cxk  where  k   rn   represents the model uncertainty. let n p  and nc be the prediction horizon and control horizon  respectively. the predicted control input after nc sample steps  are equal  i.e.  uk n   uk n   for n   nc . accordingly  we  modify the reference such that rk n   rk n   for n   nc in  the optimization problem.  let u    uk     uk             uk nc  t    u    uk      uk   uk     uk             uk nc   uk nc     t    n                    t    t        t  t   k     kt    k    k n p      . for the linear system eq.        the predicted n p future outputs y are     y   gxk   h vu   h   k   fuk    gxk   h v  s u    uk     h   k   fuk      gxk   h v s u   h   k    f   h v   uk            the closed loop system is stable in the sense that if rk and   k are bounded  the system output is bounded. assuming  k is stable  the reference is constant  i.e.  rk   r  and  k is  constant  the steady state error can be computed as  e    lim  c k n  k   c  k n             i m    r    with       yk      yk       y    .    ..              n           uk    ca    uk                 ca                 g      .      . . .    u        ..       np  yk np n    ca  uk nc n     n p     c  p              ...      cb     . . .           h       ..  ..  .   ..     . ..    .  .            canp    b canp    b . . .     c     ...    ca   c  ...     h       ..  ..  ..     .  .  .  n      n      p  p  ca    ca    ...     i  nc  n   c         ...         . .   v      .. . .  . .. ..       .    . . .      n  n   n  p    c    c      c  k n             i m    k   r     c  i   k    m    r   c  i   k    m    k   r                    ...       . . .            ..   s     .. .. . .   . .     .  .      ...  c           cb       cab              .     f      ..           .  n p  nc    canp    b                 ..    .        n p       j    y  v rk  t  y  v rk       u t  u     u t  st v t h t h v s    i  u     u t st v t h t e   e t e        where rk    rk     rk             rk nc  t   i is the identity matrix          and e   gxk   h   k    f   h v   uk   v rk . to  minimize j   u should be           u    where m   st v t h t h v s    i is always positive definite  and thus invertible. let e                     . the control law is  then  uk     uk   e   u     uk   e  m    st v t h t e    m  xk   m  uk   m  rk   m   k            where  m     e  m    st v t h t g   m         e  m    st v t h t  f   h v     m    e  m    st v t h t v  and m     e  m    st v t h t h  . therefore  the original  system can be augmented as            xk    a   k         uk    m                  b             r       m  k  m  k  m  k      k k   m   rk   m    k        ek   c    k   rk   c  k   rk    if  k can be neglected  a well designed control law should  satisfy c  i   k    m        .  next  we transform the error dynamics  eq.       into  a siso system with the reference signal as the sole input  by assuming  k    . this enables evaluating the tracking  performance of the control law  eq.       based on the frequency response of the siso system. define pk    rk   rtk  t     rk   rk     rk             rk nc  t . we have       rk    rk    ..  .                  nc           pk                     rk nc                inc  nc     pk   nc    rk nc        nc     .      k p pk   b p rk nc       the cost function for mpc is     u     argmin j    m    st v t h t e            .          obviously  the closed loop stability is determined by the  matrix k. if the eigenvalues of k all lie inside the unit circle           with rk       inc  nc  pk   br pk   we get  k     k k    m   rk   k k   m   br pk . using rk                    pk   combining  eq.      and eq.      yields   k                 k    k     pk         m   br  kp               k        r  pk  m  k nc         acl  k   bcl rk nc       .         ek    c    k                               k   ccl  k  for eq.       the input is the reference signal rk nc    and  the output is the tracking error ek . therefore  the tracking  error dynamics eq.      is a siso system with the transfer  function expressed by t  z    ccl  zi   acl     bcl which describes how the reference signal is related with the tracking  error.  remark  . since it is hard to find the relationship between  the eigenvalues of k and  n p   nc   at this point  we will  determine the smallest prediction horizon to stabilize the  system by trial and error.  remark  . while the unconstrained mpc is equivalent to  lqr when the prediction horizon is chosen to be infinite  the  former has at least two advantages over the latter. first  lqr  needs reference dynamics to perform output tracking which  is not always available for arbitrary trajectories. second   unconstrained mpc is more flexible in the sense that it can  easily incorporate the uncertainty term  k thus quite suitable  for our case  i.e.  lme .  remark  . although the computation issue of the unconstrained mpc is not significant when the prediction horizon  is large  we have to keep it as small as possible due to the                magnitude  db     term  k which is hard to be estimated in the long run. in this  work  we assume  k is fixed for a short term considering lme  is supposed to model the pea low frequency dynamics. note  that there are other methods to stabilize the system  however   it may not be able to minimize the tracking error at the same  time. for example  one can add another term   u t u in the  cost function with large    to minimize the control efforts   then the steady state error in eq.      is not zero.                         v. e xperimental r esults and d iscussion    note that the rnninv is trained with the sampling frequency of   khz and is used at sampling frequency of   khz  with the method introduced in sec. iii.b. the obtained lme  model is                     .       .       .       .       k       k    u     e    .      .        .     k   .     k .        y k    .      .      k        based on the modeling results of rnninv  lme is designed to handle the system dynamics lower than   hz.  therefore  according to the discussions in sec. ii  we set  fl     hz and fh     hz. the second cutoff frequency of  the bpf is set to be    hz. in terms of the orders of the  filters  the higher the better. we start with  rd order filters.  all the filters are of the type butterworth. as discussed in  sec. iv  the closed loop stability is determined by the matrix  k and the tracking performance can be evaluated from the  frequency response of eq.     . note that when n p is very  large  it s hard to compute the frequency response with the  transfer function t  z   in which case we resort to numerical  approaches. for a good controller  eq.      should behave  like a low pass filter with the cutoff frequency as large as  possible.  it turns out that if n p is close to nc   the minimum n p which  can stabilize k is around      and the frequency response  of the error dynamics is shown in fig.    i.e.  the controller  with  n p   nc                 . it shows that the controlling  bandwidth is about    khz. however  when n p   nc  e.g.    n p   nc                was increased  k could be stabilized  with a smaller n p . but the corresponding control bandwidth  was quite limited as seen from fig.  . recall that nc should  be kept small as explained in remark.  . therefore  we had  to lower the orders of the filters.  if the filters were second order  it was easy to make the  closed loop system stable with small n p and nc   and the  control bandwidth could reach as high as  khz as shown in  fig.  . therefore  we chose second order filters. the price  we paid for this compromise is the downgrading of tracking  performance as shown later. the bode plot of the lpf and  bpf are shown in fig.  . since the lpf and bpf were     nd lpfs n p       n c       nd lpfs n p      nc                                                   frequency  hz     fig.    frequency responses of the tracking error dynamics   eq.       with different  n p   nc  s.  magnitude db     a. choosing modeling and controller parameters     nd lpfs n p        n c                                                                                 phase deg     in this section  first  based on the lme  the parameters of  the filters and  n p   nc   are chosen to stabilize the closed loop  system. then  we will compare the tracking performance of  the proposed method with that of an iterative learning control   ilc  approach miifc     .    bpf  lpf                                                  frequency hz     fig.    bode plots of the lpf and bpf.  connected in parallel  it could be observed from fig.   that all  the signals can pass through the system  i.e.  ge g  except the  signal with ultra high frequencies  e.g.  higher than  khz .  b. tracking performance comparison  the proposed approach was implemented on a pea   nano op    mad city labs  to track different trajectories.  the tracking performance was compared with that of an efficient ilc approach miifc     . the experiment setup is  shown in fig.  . all the signals were collected and generated  through a data acquisition system  ni pcie       national  instruments  which was installed in the workstation  intel  xeon w       ram   gb . the controller was designed  using matlab simulink  mathworks  inc. .  four trajectories  including sinusoidal trajectories with the  frequencies of   hz     hz     hz  and    eq.       are  used as the reference to be tracked.    t      .   sin    . t    .       .  sin     . t     .       .  sin     .     .       .   sin      t    .       .   sin      t    .      .     . .           table i  tracking performance comparison of  ge g    g    and miifc when tracking different trajectories.    workstation with daq    refs.    erms    emax    erms    emax    erms    emax    ge g     .       .       .       .       .       .       .       .      g     .       .       .       .       .       .       .       .      miifc     .       .       .       .       .       .       .       .            .     disp.  m     nano drive controller    fig.    experimental setup       hz    emax     a     pea       hz    erms     b          error  m     bnc      hz         error                   .    .         .      .             where r    and y    are complex vectors obtained through  discrete fourier transform of the corresponding signals     .  next  we use  ge g  and  g  to denote the approaches  using the method discussed in sec. ii and without using  the new modeling method  respectively. table i shows the  tracking errors for all the three approaches while fig.    compares the tracking performance in time domain between  miifc and ge g.  observe that in table. i  ge g can decrease both the erms  and emax by at least     for all the trajectories compared to  g. this shows that the proposed method further improved the  modeling accuracy. compared to miifc  ge g outperforms  miifc in the low frequency region with the tracking errors  about     lower than that of miifc  for   hz and    hz  cases  as shown in table. i and fig.  . although the tracking  errors of ge g increased a little bit when tracking the    hz  trajectory  the tracking errors are less than   . this is mainly  because the orders of the filters are not high enough.  here  we briefly explain how the order of the filters affect  the tracking performance based on the collected data. when  tracking    hz sinusoidal signal  the output of the lpf in  fig.   should be a constant but in the experiment it includes  high frequency components as shown in fig.    which then  resulted in the tracking error. based on the bode plot in fig.     about     i.e.     db  of the input signal can pass through  the lpf which was in accordance with the experimental  data considering the input amplitude was  v. therefore  a  better lpf need to be designed with the closed loop stability  guaranteed to further improve the tracking performance.     .      .                    d      .     error  m     time s    .        .     .     .              .       .       .      time s   reference         miifc     .       .      time s   g eg     .      fig.     a  comparison of the tracking results for   signal  using ge g and miifc   b  the tracking error   c  comparison  of the tracking results for    hz sinusoidal signal using ge g  and miifc   d  the tracking error.   a      .      b      .     .           voltage  v              .     time s           disp.  m       r      y            r      y          erms    emax      r          r              .      c     voltage  v     the tracking errors erms and emax were computed as  follows      .      .        .      .     .    .     .                .      .      .      .           .     .     time  s      .       .       .      time  s     fig.     a  output of the lpf   b  zoomed in view of the  rectangle area.  the equation of error dynamics is derived  which are used  to guide the selection of the filter parameters and controller  parameters. the proposed approach has been validated with  experiments on a commercial pea showing that the tracking  precision has been significantly improved.  acknowledgment  this work was supported by the national science foundation  nsf   cmmi          and iowa state university.    vi. c onclusion  in this work  we enhanced the performance of rnninv  in tracking control in two aspects the tracking accuracy  is further improved and the sampling frequency is doubled.  we analyzed the closed loop stability of the control law and    